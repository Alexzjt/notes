# Volatile 是什么？

volatile是java虚拟机提供的轻量级线程同步机制。

1. 保证可见性
2. 不保证原子性
3. 禁止指令重排

JMM是Java Memory Model ，Java内存模型。本身是一种抽象的概念。

1. 可见性
2. 原子性：number++在多线程下是非
3. 有序性

关于同步的规定：

1. 线程解锁前，必须把恭喜变量的值刷新回主内存
2. 线程加锁前，必须读取主内存的最新值到自己的工作内存
3. 加锁解锁时同一把锁

由于JVM运行程序的实体是线程，而每个线程创建时JVM都会为其创建（工作内存）栈空间，这是每个线程的私有数据区域。Java内存模型规定所有变量都存储在主内存，主内存是共享内存区域，所有线程都可以访问，**但线程对变量的操作必须要在栈空间中进行，首先要将变量从主内存拷贝到自己的栈空间，然后对变量进行操作，操作完成后再将变量写回主内存**，不能直接操作主内存中的变量。各个线程中的工作内存中存储着主内存中的变量副本拷贝，因此不同的线程间无法访问对方的栈空间，线程之间的通信传值必须通过主内存来完成。

##### volatile可见性原理

1. 将当前内核高速缓存行的数据立刻回写到内存

2. 使在其他内核里缓存了该内存地址的数据无效（MESI协议保证）

##### 在哪些地方用过volatile

单例模式

DoubleCheckLock写法，要用volatile保证
